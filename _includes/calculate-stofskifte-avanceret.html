<script>
    function calculate(form) {
        var bmr;
        var age = parseInt(form.age.value);
        var weight = parseInt(form.weight.value);
        var height = parseInt(form.height.value); // convert to meters
        var sex = form.sexHidden.value;
        var alder= age;
        var vaegt = weight;

        // Værdier baseret på Schofield
        if (sex == "male") {
            if ((alder > 0) && (alder < 3)) {
                bmr = 249 * vaegt - 127;
            }
            else if ((alder > 2) && (alder < 11)) {
                bmr = 95 * vaegt + 2110;
            }
            else if ((alder > 10) && (alder < 19)) {
                bmr = 74 * vaegt + 2754;
            }
            else if ((alder > 18) && (alder < 31)) {
                bmr = 63 * vaegt + 2896;
            }
            else if ((alder > 30) && (alder < 61)) {
                bmr = 48 * vaegt + 3653;
            }
            else if ((alder > 60)) {
                bmr = 49.9 * vaegt + 2930;
            }
        }
        else if (sex == "female") {
            if ((alder > 0) && (alder < 3)) {
                bmr = 244 * vaegt - 130;
            }
            else if ((alder > 2) && (alder < 11)) {
                bmr = 85 * vaegt + 2033;
            }
            else if ((alder > 10) && (alder < 19)) {
                bmr = 56 * vaegt + 2898;
            }
            else if ((alder > 18) && (alder < 31)) {
                bmr = 62 * vaegt + 2036;
            }
            else if ((alder > 30) && (alder < 61)) {
                bmr = 34 * vaegt + 3538;
            }
            else if ((alder > 60)) {
                bmr = 38 * vaegt + 2755;
            }
        }

	    var basicMeta = bmr;
	    var BMR = bmr;
	    
        var min_day = 24 * 60;
        var activity_intense = document.getElementById('activity_intense').value;
        var activity_moderat = document.getElementById('activity_moderat').value;
        var activity_light = document.getElementById('activity_light').value;
        var activity_standing = document.getElementById('activity_standing').value;
        var activity_sleeping = document.getElementById('activity_sleeping').value;

        var activity_sitting = min_day - activity_intense - activity_moderat - activity_light - activity_standing - activity_sleeping;

        var met_intense = 10;
        var met_moderat = 7;
        var met_light = 4;
        var met_standing = 2;
        var met_sleeping = 0.9;
        var met_sitting = 1;
        
        var pal_intense = (met_intense * (activity_intense / 1440));
        var pal_moderat = (met_moderat * (activity_moderat / 1440));
        var pal_light = (met_light * (activity_light / 1440));
        var pal_standing = (met_standing * (activity_standing / 1440));
        var pal_sleeping = (met_sleeping * (activity_sleeping / 1440));
        var pal_sitting = (met_sitting * (activity_sitting / 1440));

        var pal = pal_intense + pal_moderat + pal_light + pal_standing + pal_sleeping + pal_sitting;
        /*
        var pal_intense = ((met_intense - 1) * ((1.15 / 0.9) * activity_intense) / 1440) / (basicMeta / (0.0175 * 1440 * weight));
        var pal_moderat = ((met_moderat - 1) * ((1.15 / 0.9) * activity_moderat) / 1440) / (basicMeta / (0.0175 * 1440 * weight));
        var pal_light = ((met_light - 1) * ((1.15 / 0.9) * activity_light) / 1440) / (basicMeta / (0.0175 * 1440 * weight));
        var pal_standing = ((met_standing - 1) * ((1.15 / 0.9) * activity_standing) / 1440) / (basicMeta / (0.0175 * 1440 * weight));
        var pal_sleeping = ((met_sleeping - 1) * ((1.15 / 0.9) * activity_sleeping) / 1440) / (basicMeta / (0.0175 * 1440 * weight));
        var pal_sitting = ((met_sitting - 1) * ((1.15 / 0.9) * activity_sitting) / 1440) / (basicMeta / (0.0175 * 1440 * weight));
        var pal = 1.1 + pal_intense + pal_moderat + pal_light + pal_standing + pal_sleeping + pal_sitting;
        */

        var activityConstant = pal;

        // Corrections proposed by Morten Zacho
        var bmi = weight / ((height / 100) * (height / 100));
	    var TEE;
    	var correction1;
    	var correction2;
	    var correction3;
	    if (bmi > 30) {
		    correction1 = Math.sqrt(30) / Math.sqrt(bmi);
		    correction2 = 30 / bmi;
		    correction3 = 30 / bmi;
	    } else {
		    correction1 = 1;
		    correction2 = 1;
		    correction3 = 1;
	    }

        var factor = (0.03 * activity_sitting + 0.1 * activity_standing + 0.26 * activity_light * correction1 + 0.5 * activity_moderat * correction2 + 0.88 * activity_intense * correction3);

	    // Correction for children
	    if (weight < 50) {
	        var weight_correction = (1 + 0.5 * (50 - weight) / 50);
		    TEE = Math.round(BMR + weight * ((0.03 * activity_sitting + 0.1 * activity_standing + 0.26 * activity_light * correction1 + 0.5 * activity_moderat * correction2 + 0.88 * activity_intense * correction3)) * weight_correction);
	    } else {		
		    TEE = Math.round(BMR + weight * ((0.03 * activity_sitting + 0.1 * activity_standing + 0.26 * activity_light * correction1 + 0.5 * activity_moderat * correction2 + 0.88 * activity_intense * correction3)));
	    }
	    /*
	    // Correction for children
	    if (weight < 50) {
		    TEE = Math.round(BMR + weight * ((0.03 * timeDialsTimeRemain() + 0.1 * dialsArray[6].dialValue + 0.26 * dialsArray[5].dialValue * correction1 + 0.5 * dialsArray[4].dialValue * correction2 + 0.88 * dialsArray[3].dialValue * correction3)) * (1 + 0.5 * (50 - weight) / 50));
	    } else {		
		    TEE = Math.round(BMR + weight * ((0.03 * timeDialsTimeRemain() + 0.1 * dialsArray[6].dialValue + 0.26 * dialsArray[5].dialValue * correction1 + 0.5 * dialsArray[4].dialValue * correction2 + 0.88 * dialsArray[3].dialValue * correction3)));
	    }
	    */

        var vedligehold = basicMeta * activityConstant;

        document.getElementById('pal').value = pal;
        document.getElementById('activity_sitting').value = activity_sitting;
        document.getElementById('bmr').value = basicMeta + " kJ";
        document.getElementById('equilibrium').value = vedligehold + " kJ";
        document.getElementById('TEE').value = TEE + " kJ";
        document.getElementById('factor').value = factor;
        return false;
    }
</script>
<form class="calculator" id="form1">
    <fieldset>
        <legend>Avanceret udregning af dit stofskifte, energibehov og ligevægtsindtag baseret på Schofield (1985).</legend>
        <fieldset>
            <legend>Køn</legend>
            <label for="male" class="radio"><input type="radio" name="sex" value="male" id="male" onclick="this.form.sexHidden.value = 'male';" checked="checked"> Mand</label>
    		<label for="female" class="radio"><input type="radio" name="sex" value="female" id="female" onclick="this.form.sexHidden.value = 'female';"> Kvinde</label>
    		<input type="hidden" name="sexHidden" value="male">
        </fieldset>
        <div class="form-group">
            <label for="age">Alder (år)</label>
            <input type="number" min="10" max="100" placeholder="fx 40" name="age" id="age">
        </div>
        <div class="form-group">
            <label for="weight">Vægt (kg)</label>
            <input type="number" min="10" max="200" placeholder="fx 70" name="weight" id="weight" step="0.1">
        </div>
        <div class="form-group">
            <label for="height">Højde (cm)</label>
            <input type="number" min="10" max="240" placeholder="fx 170" name="height" id="height" step="0.1">
        </div>
        <fieldset>
            <legend>Angiv dit daglige fysiske aktivitetsniveau</legend>
        <div class="form-group">
            <label for="height">Intens træning (min)</label>
            <input type="number" min="0" max="1440" placeholder="" name="activity_intense" id="activity_intense" onchange="calculate(this.form);">
            <p class="help-block">Maksimal aktivitet. Intensiv idræt. Hurtig løb. Hurtig roning.</p>
        </div>
        <div class="form-group">
            <label for="height">Moderat træning (min)</label>
            <input type="number" min="0" max="1440" placeholder="" name="activity_moderat" id="activity_moderat" onchange="calculate(this.form);">
            <p class="help-block">Styrketræning. Hugge brænde. De fleste idrætsgrene. Cykling.</p>
        </div>
        <div class="form-group">
            <label for="height">Let aktivitet (min)</label>
            <input type="number" min="0" max="1440" placeholder="" name="activity_light" id="activity_light" onchange="calculate(this.form);">
            <p class="help-block">Husarbejde. Havearbejde. Hurtig gang. Golf.</p>
        </div>
        <div class="form-group">
            <label for="height">Stående og gående (min)</label>
            <input type="number" min="00" max="1440" placeholder="" name="activity_standing" id="activity_standing" onchange="calculate(this.form);">
            <p class="help-block">Madlavning. Let gang. Indkøb. Shopping.</p>
        </div>
        <div class="form-group">
            <label for="height">Sove (min)</label>
            <input type="number" min="0" max="1440" placeholder="" name="activity_sleeping" id="activity_sleeping" onchange="calculate(this.form);">
            <p class="help-block">Fra du ligger i sengen til du står op.</p>
        </div>
        <div class="form-group">
            <label for="height">Siddende (min)</label>
            <input type="number" min="0" max="1440" value="1440" name="activity_sitting" id="activity_sitting" disabled="disabled">
            <p class="help-block">Den resterende tid.</p>
        </div>
        </fieldset>
        <input type="submit" value="Beregn" onclick="return calculate(this.form);">
    </fieldset>
    <fieldset class="results">
        <div class="form-group">
            <label for="pal">Physical Activity Level (PAL)</label>
            <input name="pal" id="pal" disabled="disabled">
        </div>
        <div class="form-group">
            <label for="bmr">Basalstofskifte (BMR) (kJ)</label>
            <input name="bmr" id="bmr" disabled="disabled">
        </div>
        <div class="form-group">
            <label for="equilibrium">Stofskifte og ligevægtsindtag på en dag (kJ)</label>
            <input name="equilibrium" id="equilibrium" disabled="disabled">
        </div>
        <div class="form-group">
            <label for="TEE">Korrigeret for vægt og BMI (kJ)</label>
            <input name="TEE" id="TEE" disabled="disabled">
        </div>
        <div class="form-group">
            <label for="factor">Faktor</label>
            <input name="factor" id="factor" disabled="disabled">
        </div>
    </fieldset>
</form>
